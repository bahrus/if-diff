import{XtallatX}from"xtal-element/xtal-latx.js";import{disabled,hydrate,up}from"trans-render/hydrate.js";import{define}from"trans-render/define.js";import{debounce}from"xtal-element/debounce.js";import{NavDown}from"xtal-element/NavDown.js";const if$="if",lhs="lhs",rhs="rhs",tag="tag",equals="equals",not_equals="not_equals",toggle_disabled="toggle_disabled",m$="m";export class IfDiff extends(XtallatX(hydrate(HTMLElement))){constructor(){super(...arguments),this._conn=!1,this._navDown=null}static get is(){return"if-diff"}static get observedAttributes(){return[if$,lhs,rhs,tag,equals,not_equals,disabled,m$]}get if(){return this._if}set if(t){this.attr(if$,!!t,"")}get lhs(){return this._lhs}set lhs(t){this.attr(lhs,t.toString())}get rhs(){return this._rhs}set rhs(t){this.attr(rhs,t.toString())}get equals(){return this._equals}set equals(t){this.attr(equals,t,"")}get not_equals(){return this._not_equals}set not_equals(t){this.attr(not_equals,t,"")}get toggle_disabled(){return this._toggle_disabled}set toggle_disabled(t){this.attr(toggle_disabled,t,"")}get tag(){return this._tag}set tag(t){this.attr(tag,t)}get m(){return this._m}set m(t){this.attr(m$,t.toString())}attributeChangedCallback(t,s,e){super.attributeChangedCallback(t,s,e);const a="_"+t;switch(t){case equals:case not_equals:case if$:this[a]=null!==e;break;case tag:case lhs:case rhs:case m$:this[a]=e}this.onPropsChange()}init(){this.passDown()}connectedCallback(){this.style.display="none",this[up](IfDiff.observedAttributes),this._conn=!0,this._debouncer=debounce((t=!1)=>{this.passDown()},16),setTimeout(()=>{this.init()},50)}onPropsChange(){this._conn&&!this._disabled&&this._debouncer()}loadTemplate(t){const s=t.querySelector("template");s?(t.appendChild(s.content.cloneNode(!0)),s.remove()):setTimeout(()=>{this.loadTemplate(t)},50)}tagMatches(t){const s=t.matches,e=this.value,a=this._tag;s.forEach(t=>{"0"===t.dataset[a]?e&&(this.loadTemplate(t),t.dataset[a]="1"):t.dataset[a]=e?"1":"-1",this._toggle_disabled&&(e?t.removeAttribute("disabled"):t.setAttribute("disabled",""))})}passDown(){let t=this._if;if(t&&(this._equals||this._not_equals)&&(t=this._equals?this._lhs===this._rhs:this._lhs!==this._rhs),this.value=t,this.de("value",{value:t}),this._tag)if(null===this._navDown){this._tag;const t=t=>t.dataset&&!!t.dataset[this._tag],s=this._m?this._m:1/0,e=this.tagMatches.bind(this);this._navDown=new NavDown(this,t,t=>e(t),s),this._navDown.init()}else this.tagMatches(this._navDown)}disconnect(){this._navDown&&this._navDown.disconnect()}}define(IfDiff);