<!DOCTYPE html>
<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-if.html">



<script>
  (function() {
  'use strict';
   function initIfDiff(){
        /**
        * `if-diff`
        * Extension of polymer&#39;s dom-if element that allows comparison between two operands.
        * dom-if only allows testing simple boolean properties, not complex expressions.
        * But comparing two strings is the next most common way to define a conditional display.  
        * That is what if-diff supports. 
        *
        * @customElement
        * @polymer
        * @demo demo/index.html
        */
        class IfDiff extends Polymer.DomIf {
          static get is() { return 'if-diff'; }
          static get properties() {
            return {
              /**
              * Left hand side of comparison operation
              */
              lhs: {
                type: String,
                observer: '__debounceRender'
              },
              /**
              * LHS must equal RHS
              */
              equals: {
                type: Boolean,
                observer: '__debounceRender'
              },
              /**
              * LHS must not equal RHS
              */
              not_equals:{
                type: Boolean,
                observer: '__debounceRender'
              },
              /**
              * LHS must be greater than RHS
              */
              greater_than:{
                type: Boolean,
                observer: '__debounceRender'
              },
              /**
              *  Right hand side of comparison operation
              */
              rhs: {
                type: String,
                observer: '__debounceRender'
              },
              /**
              * Result of evaluating logical expression
              */
              result:{
                type: String,
                readOnly:true,
                notify: true
              },
              /**
              *  Inherited from dom-if
              */
              if: {
                type: Boolean,
                observer: '__debounceRender',
              }
            };
          }
          
          __evaluateProperties(){
            if(!this.if) return false;
            if(this.greater_than){
              if(this.lhs > this.rhs) return true;
            }
            if(this.equals){
              return (this.lhs === this.rhs);
            }
            if(this.not_equals){
              return (this.lhs !== this.rhs);
            }
            return true;
          }

          __render() {
            const result = this.__evaluateProperties();
            if(result !== this.__previousResult){
              this._setResult(result);
            }
            this.__previousResult = result;
            if (result) {
              if (!this.__ensureInstance()) {
                // No template found yet
                return;
              }
              this._showHideChildren();
            } else if (this.restamp) {
              this.__teardownInstance();
            }
            if (!this.restamp && this.__instance) {
              this._showHideChildren();
            }
            if (this.if != this._lastIf) {
              this.dispatchEvent(new CustomEvent('dom-change', {
                bubbles: true,
                composed: true
              }));
              this._lastIf = this.if;
            }
          }

          _showHideChildren() {
            let hidden = this.__hideTemplateChildren__ || !this.__evaluateProperties();
            if (this.__instance) {
              this.__instance._showHideChildren(hidden);
            }
          }
        }



        customElements.define(IfDiff.is, IfDiff);
   }
    customElements.whenDefined('dom-if').then(() =>{
      initIfDiff();
    })
  })();
</script>

