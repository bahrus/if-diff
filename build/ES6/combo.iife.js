(function(){function define(custEl){let tagName=custEl.is;if(customElements.get(tagName)){console.warn("Already registered "+tagName);return}customElements.define(tagName,custEl)}const debounce=(fn,time)=>{let timeout;return function(){clearTimeout(timeout);timeout=setTimeout(()=>fn.apply(this,arguments),time)}},disabled="disabled";function XtallatX(superClass){return class extends superClass{constructor(){super(...arguments);this._evCount={}}static get observedAttributes(){return[disabled]}get disabled(){return this._disabled}set disabled(val){this.attr(disabled,val,"")}attr(name,val,trueVal){const v=val?"set":"remove";this[v+"Attribute"](name,trueVal||val)}to$(n){const mod=n%2;return(n-mod)/2+"-"+mod}incAttr(name){const ec=this._evCount;if(name in ec){ec[name]++}else{ec[name]=0}this.attr("data-"+name,this.to$(ec[name]))}attributeChangedCallback(name,oldVal,newVal){switch(name){case disabled:this._disabled=null!==newVal;break;}}de(name,detail,asIs){const eventName=name+(asIs?"":"-changed"),newEvent=new CustomEvent(eventName,{detail:detail,bubbles:!0,composed:!1});this.dispatchEvent(newEvent);this.incAttr(eventName);return newEvent}_upgradeProperties(props){props.forEach(prop=>{if(this.hasOwnProperty(prop)){let value=this[prop];delete this[prop];this[prop]=value}})}}}class NavDown{constructor(seed,match,notify,max,mutDebounce=50){this.seed=seed;this.match=match;this.notify=notify;this.max=max;this.mutDebounce=mutDebounce}init(){this._debouncer=debounce(()=>{this.sync()},this.mutDebounce);this.sync();this.addMutObs(this.seed.parentElement)}addMutObs(elToObs){if(null===elToObs||elToObs._addedMutObs)return;this._mutObs=new MutationObserver(()=>{this._debouncer(!0)});this._mutObs.observe(elToObs,{childList:!0});elToObs._addedMutObs=!0}sibCheck(){}sync(c=0){const isF="function"===typeof this.match;this.matches=[];let ns=this.seed.nextElementSibling;while(null!==ns){let isG=isF?this.match(ns):ns.matches(this.match);if(isG){this.matches.push(ns);c++;if(c>=this.max){this.notify(this);return}}this.sibCheck(ns,c);ns=ns.nextElementSibling}this.notify(this)}disconnect(){this._mutObs.disconnect()}}class PDNavDown extends NavDown{constructor(){super(...arguments);this.children=[]}sibCheck(sib){if(sib.__aMO)return;const attr=sib.getAttribute("p-d-if");if(null===attr){sib.__aMO=!0;return}const fec=sib.firstElementChild;if(null===fec)return;if(this.root.matches(attr)){const pdnd=new PDNavDown(fec,this.match,this.notify,this.max,this.mutDebounce);pdnd.root=this.root;this.children.push(pdnd);pdnd.init();sib.__aMO=!0}}getMatches(){let ret=this.matches;this.children.forEach(child=>{ret=ret.concat(child.getMatches())});return ret}}const on="on",noblock="noblock",iff="if",to="to";class P extends XtallatX(HTMLElement){constructor(){super();this._connected=!1}get on(){return this._on}set on(val){this.attr(on,val)}get to(){return this._to}set to(val){this.attr(to,val)}get noblock(){return this._noblock}set noblock(val){this.attr(noblock,val,"")}get if(){return this._if}set if(val){this.attr(iff,val)}static get observedAttributes(){return super.observedAttributes.concat([on,to,noblock,iff])}attributeChangedCallback(name,oldVal,newVal){const f="_"+name;switch(name){case iff:case on:this[f]=newVal;break;case to:this._destIsNA="{NA}"===newVal;if(newVal.endsWith("}"))newVal+=";";this._to=newVal;this.parseTo();if(this._lastEvent)this._hndEv(this._lastEvent);break;case noblock:this[f]=null!==newVal;break;}super.attributeChangedCallback(name,oldVal,newVal)}getPSib(){let pS=this;while(pS&&pS.tagName.startsWith("P-")){pS=pS.previousElementSibling}return pS}connectedCallback(){this.style.display="none";this._upgradeProperties([on,to,noblock,iff]);setTimeout(()=>this.doFake(),50)}doFake(){if(!this._if&&!this.hasAttribute("skip-init")){let lastEvent=this._lastEvent;if(!lastEvent){lastEvent={target:this.getPSib(),isFake:!0}}if(this._hndEv)this._hndEv(lastEvent)}}detach(pS){pS.removeEventListener(this._on,this._bndHndlEv)}disconnectedCallback(){const pS=this.getPSib();if(pS&&this._bndHndlEv)this.detach(pS)}_hndEv(e){if(this.hasAttribute("debug"))debugger;if(!e)return;if(e.stopPropagation&&!this._noblock)e.stopPropagation();if(this._if&&!e.target.matches(this._if))return;this._lastEvent=e;if(!this._cssPropMap){return}this.pass(e)}attchEvListnrs(){const pS=this.getPSib();if(!pS)return;if(this._bndHndlEv){return}else{this._bndHndlEv=this._hndEv.bind(this)}pS.addEventListener(this._on,this._bndHndlEv);const da=pS.getAttribute("disabled");if(null!==da){if(0===da.length||"1"===da){pS.removeAttribute("disabled")}else{pS.setAttribute("disabled",(parseInt(da)-1).toString())}}}onPropsChange(){if(!this._connected||!this._on||!this._to)return;this.attchEvListnrs()}parseMapping(mapTokens,cssSelector){const splitPropPointer=mapTokens[1].split(":");this._cssPropMap.push({cssSelector:cssSelector,propTarget:splitPropPointer[0],propSource:0<splitPropPointer.length?splitPropPointer[1]:void 0})}parseTo(){if(this._cssPropMap&&this._to===this._lastTo)return;this._lastTo=this._to;this._cssPropMap=[];const splitPassDown=this._to.split("};"),onlyOne=2>=splitPassDown.length;splitPassDown.forEach(pdItem=>{if(!pdItem)return;const mT=pdItem.split("{");let cssSel=mT[0];if(!cssSel&&onlyOne){cssSel="*";this._m=1;this._hasMax=!0}this.parseMapping(mT,cssSel)})}setVal(e,target,map){const gpfp=this.getPropFromPath.bind(this),propFromEvent=map.propSource?gpfp(e,map.propSource):gpfp(e,"detail.value")||gpfp(e,"target.value");this.commit(target,map,propFromEvent)}commit(target,map,val){if(val===void 0)return;target[map.propTarget]=val}getPropFromPath(val,path){if(!path||"."===path)return val;return this.getProp(val,path.split("."))}getProp(val,pathTokens){let context=val,firstToken=!0;const cp="composedPath";pathTokens.forEach(token=>{if(context){if(firstToken&&context[cp]){firstToken=!1;const cpath=token.split(cp+"_");if(1===cpath.length){context=context[cpath[0]]}else{context=context[cp]()[parseInt(cpath[1])]}}else{context=context[token]}}});return context}}const m="m";class PD extends P{constructor(){super(...arguments);this._pdNavDown=[];this._m=1/0}static get is(){return"p-d"}get m(){return this._m}set m(val){this.attr(m,val.toString())}static get observedAttributes(){return super.observedAttributes.concat([m])}pass(e){this._lastEvent=e;this.attr("pds","\uD83C\uDF29\uFE0F");this._pdNavDown.forEach(pdnd=>{this.applyProps(pdnd)});this.attr("pds","\uD83D\uDC42")}applyProps(pd){pd.getMatches().forEach(el=>{this._cssPropMap.filter(map=>map.cssSelector===pd.match).forEach(map=>{this.setVal(this._lastEvent,el,map)})})}attributeChangedCallback(name,oldVal,newVal){switch(name){case m:if(null!==newVal){this._m=parseInt(newVal)}}super.attributeChangedCallback(name,oldVal,newVal);this.onPropsChange()}connectedCallback(){super.connectedCallback();this._upgradeProperties([m]);this._connected=!0;this.attr("pds","\uD83D\uDCDE");const bndApply=this.applyProps.bind(this);this._cssPropMap.forEach(pm=>{const pdnd=new PDNavDown(this,pm.cssSelector,nd=>bndApply(nd),this.m);pdnd.root=this;pdnd.init();this._pdNavDown.push(pdnd)});this.onPropsChange()}}define(PD);const if$="if",lhs="lhs",rhs="rhs",tag="tag",equals="equals",not_equals="not_equals",m$="m";class IfDiff extends XtallatX(HTMLElement){constructor(){super(...arguments);this._conn=!1;this._navDown=null}static get is(){return"if-diff"}static get observedAttributes(){return[if$,lhs,rhs,tag,equals,not_equals,disabled,m$]}get if(){return this._if}set if(nv){this.attr(if$,!!nv,"")}get lhs(){return this._lhs}set lhs(nv){this.attr(lhs,nv.toString())}get rhs(){return this._rhs}set rhs(nv){this.attr(rhs,nv.toString())}get equals(){return this._equals}set equals(nv){this.attr(equals,nv,"")}get not_equals(){return this._not_equals}set not_equals(nv){this.attr(not_equals,nv,"")}get tag(){return this._tag}set tag(nv){this.attr(tag,nv)}get m(){return this._m}set m(v){this.attr(m$,v.toString())}attributeChangedCallback(n,ov,nv){super.attributeChangedCallback(n,ov,nv);const u="_"+n;switch(n){case equals:case not_equals:case if$:this[u]=null!==nv;break;case tag:case lhs:case rhs:case m$:this[u]=nv;break;}this.onPropsChange()}init(){this.passDown()}connectedCallback(){this.style.display="none";this._upgradeProperties(IfDiff.observedAttributes);this._conn=!0;this._debouncer=debounce((getNew=!1)=>{this.passDown()},16);setTimeout(()=>{this.init()},50)}onPropsChange(){if(!this._conn||this._disabled)return;this._debouncer()}loadTemplate(el){const tmpl=el.querySelector("template");if(!tmpl){setTimeout(()=>{this.loadTemplate(el)},50);return}el.appendChild(tmpl.content.cloneNode(!0));tmpl.remove()}tagMatches(nd){const matches=nd.matches,val=this.value,t=this._tag;matches.forEach(el=>{const ds=el.dataset;if("0"===ds[t]){if(val){this.loadTemplate(el);el.dataset[t]="1"}}else{el.dataset[t]=val?"1":"-1"}})}passDown(){let val=this._if;if(val&&(this._equals||this._not_equals)){if(this._equals){val=this._lhs===this._rhs}else{val=this._lhs!==this._rhs}}this.value=val;this.de("value",{value:val});if(this._tag){if(null===this._navDown){const tag=this._tag,max=this._m?this._m:1/0,bndTagMatches=this.tagMatches.bind(this);this._navDown=new NavDown(this,el=>el.dataset&&!!el.dataset[this._tag],nd=>bndTagMatches(nd),max);this._navDown.init()}else{this.tagMatches(this._navDown)}}}disconnect(){if(this._navDown)this._navDown.disconnect()}}define(IfDiff)})();